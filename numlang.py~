import math

variables = {}

# Allowed math functions & constants
math_env = {
    "sqrt": math.sqrt,
    "sin": math.sin,
    "cos": math.cos,
    "tan": math.tan,
    "log": math.log,
    "pi": math.pi,
    "e": math.e
}

def evaluate(expr):
    expr = expr.replace("^", "**")
    return eval(expr, {"__builtins__": {}}, {**math_env, **variables})


def run_code(code):
    """
    Runs full NumLang script from IDE / Flask
    """
    output = []
    lines = code.split("\n")

    for line in lines:
        line = line.strip()

        try:
            if not line or line.startswith("#"):
                continue

            elif line.startswith("let "):
                parts = line[4:].split("=")
                name = parts[0].strip()
                expr = parts[1].strip()

                value = evaluate(expr)
                variables[name] = value

            elif line.startswith("print "):
                expr = line[6:].strip()
                value = evaluate(expr)
                output.append(str(value))

            else:
                output.append("Unknown command")

        except Exception as e:
            output.append(f"Error: {e}")

    return "\n".join(output)


#  CLI MODE
if __name__ == "__main__":
    print("Math Language v1.0 ")
    print("Type 'exit' to quit\n")

    while True:
        line = input(">>> ").strip()

        if line == "exit":
            break

        result = run_code(line)
        print(result)
