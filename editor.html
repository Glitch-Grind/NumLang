<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NumLang Editor</title>

<style>
@font-face {
    font-family: "JetBrainsMono";
    src: url("fonts/JetBrainsMono-Regular.woff2") format("woff2");
    font-weight: normal;
    font-style: normal;
}

body {
    margin: 0;
    background: #0f111a;
    overflow: hidden;
    font-family: "JetBrainsMono", Consolas, monospace;
}

canvas {
    display: block;
}
</style>
</head>

<body>
<canvas id="editor"></canvas>

<script>
const canvas = document.getElementById("editor");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let lines = [""];
let cursorX = 0;
let cursorY = 0;
let showCaret = true;

const fontSize = 16;
const lineHeight = 24;
const padding = 60;

ctx.font = fontSize + "px JetBrainsMono, Consolas, monospace";

function draw() {
    ctx.fillStyle = "#0f111a";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    lines.forEach((line, i) => {
        const y = (i + 1) * lineHeight;

        // Line numbers
        ctx.fillStyle = "#3b4261";
        ctx.fillText(i + 1, 20, y);

        drawHighlightedText(line, padding, y);
    });

    if (showCaret) drawCaret();
}

function drawHighlightedText(text, x, y) {
    const tokens = text.split(/(\s+)/);

    let offsetX = x;

    tokens.forEach(token => {
        ctx.fillStyle = getTokenColor(token);
        ctx.fillText(token, offsetX, y);
        offsetX += ctx.measureText(token).width;
    });
}

function getTokenColor(token) {
    if (/^\d+(\.\d+)?$/.test(token)) return "#89ddff"; // numbers
    if (/^(let|print)$/.test(token)) return "#c792ea"; // keywords
    if (/^(sqrt|sin|cos|tan|log)$/.test(token)) return "#82aaff"; // functions
    if (/^[=+\-*/^()]+$/.test(token)) return "#ffcb6b"; // operators
    return "#d4d4d4"; // default
}

function drawCaret() {
    const textBeforeCursor = lines[cursorY].slice(0, cursorX);
    const x = padding + ctx.measureText(textBeforeCursor).width;
    const y = cursorY * lineHeight + 8;

    ctx.fillStyle = "#ffffff";
    ctx.fillRect(x, y, 2, lineHeight - 10);
}

setInterval(() => {
    showCaret = !showCaret;
    draw();
}, 500);

document.addEventListener("keydown", e => {
    const line = lines[cursorY];

    if (e.key === "Backspace") {
        if (cursorX > 0) {
            lines[cursorY] =
                line.slice(0, cursorX - 1) +
                line.slice(cursorX);
            cursorX--;
        } else if (cursorY > 0) {
            cursorX = lines[cursorY - 1].length;
            lines[cursorY - 1] += line;
            lines.splice(cursorY, 1);
            cursorY--;
        }
    }

    else if (e.key === "Enter") {
        const newLine = line.slice(cursorX);
        lines[cursorY] = line.slice(0, cursorX);
        lines.splice(cursorY + 1, 0, newLine);

        cursorY++;
        cursorX = 0;
    }

    else if (e.key === "ArrowLeft") {
        if (cursorX > 0) cursorX--;
        else if (cursorY > 0) {
            cursorY--;
            cursorX = lines[cursorY].length;
        }
    }

    else if (e.key === "ArrowRight") {
        if (cursorX < line.length) cursorX++;
        else if (cursorY < lines.length - 1) {
            cursorY++;
            cursorX = 0;
        }
    }

    else if (e.key === "ArrowUp") {
        if (cursorY > 0) {
            cursorY--;
            cursorX = Math.min(cursorX, lines[cursorY].length);
        }
    }

    else if (e.key === "ArrowDown") {
        if (cursorY < lines.length - 1) {
            cursorY++;
            cursorX = Math.min(cursorX, lines[cursorY].length);
        }
    }

    else if (e.key.length === 1) {
        lines[cursorY] =
            line.slice(0, cursorX) +
            e.key +
            line.slice(cursorX);

        cursorX++;
    }

    draw();
});

draw();
</script>
</body>
</html>
